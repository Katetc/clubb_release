#define SCLR_THETA 1
#define SCLR_RT 2
!----------------------------------------------------------------------
! $Id: lba.F,v 1.6 2008-04-04 22:02:49 dschanen Exp $
        module lba

!       Description:
!       Contains subroutines for the LBA case.
!----------------------------------------------------------------------
        public :: lba_tndcy, lba_sfclyr

        contains

!----------------------------------------------------------------------
        subroutine lba_tndcy( time, wmt, wmm, radht,
     .                        thlm_forcing, rtm_forcing,
     .                        sclrm_forcing )
!       Description:
!       Subroutine to set theta and water tendencies for LBA case.

!       References:
!----------------------------------------------------------------------

        use grid_class
        use model_flags, only: lbugsrad
        use constants, only: sclr_dim
        use zlinterp, only: zlinterp_fnc
        use stats_prec, only: time_prec

        implicit none

        ! Constant Parameters
        integer, parameter :: ntimes = 36, nzrad = 33

        real, parameter, dimension(nzrad) ::
     .  zrad = 
     .  (/ 42.500, 200.92, 456.28, 743.00, 1061.1, 1410.5, 1791.3,
     .     2203.5, 2647.0, 3121.9, 3628.1, 4165.7, 4734.7, 5335.0,
     .     5966.7, 6629.7, 7324.1, 8049.9, 8807.0, 9595.5, 10415.,    
     .     11267., 12149., 13063., 14008., 14985., 15993., 17032.,
     .     18103., 19205., 20339., 21503., 22699. /)

        real, parameter, dimension(nzrad, ntimes) ::
     .  krad = reshape( shape=(/nzrad, ntimes/), source=
     .  (/ 
     . -0.16042E-04,-0.22303E-04,-0.24178E-04,-0.22789E-04,-0.20891E-04,
     . -0.18345E-04,-0.16273E-04,-0.15243E-04,-0.13750E-04,-0.12801E-04,
     . -0.12766E-04,-0.11863E-04,-0.11053E-04,-0.12095E-04,-0.13241E-04,
     . -0.12951E-04,-0.12361E-04,-0.12639E-04,-0.13843E-04,-0.14502E-04,
     . -0.14653E-04,-0.15116E-04,-0.10995E-04, 0.14120E-05, 0.29514E-05,
     .  0.29861E-05, 0.37269E-05, 0.15625E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.16042E-04,-0.22303E-04,-0.24178E-04,-0.22789E-04,-0.20891E-04,
     . -0.18345E-04,-0.16273E-04,-0.15243E-04,-0.13750E-04,-0.12801E-04,
     . -0.12766E-04,-0.11863E-04,-0.11053E-04,-0.12095E-04,-0.13241E-04,
     . -0.12951E-04,-0.12361E-04,-0.12639E-04,-0.13843E-04,-0.14502E-04,
     . -0.14653E-04,-0.15116E-04,-0.10995E-04, 0.14120E-05, 0.29514E-05,
     .  0.29861E-05, 0.37269E-05, 0.15625E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.14236E-04,-0.21111E-04,-0.23275E-04,-0.21933E-04,-0.20012E-04,
     . -0.17454E-04,-0.15405E-04,-0.14363E-04,-0.12836E-04,-0.11852E-04,
     . -0.11782E-04,-0.10880E-04,-0.10035E-04,-0.11030E-04,-0.12106E-04,
     . -0.11782E-04,-0.11250E-04,-0.11644E-04,-0.12951E-04,-0.13738E-04,
     . -0.13993E-04,-0.14572E-04,-0.10637E-04, 0.14120E-05, 0.30556E-05,
     .  0.30324E-05, 0.37731E-05, 0.15856E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.12072E-04,-0.19583E-04,-0.22060E-04,-0.20787E-04,-0.18866E-04,
     . -0.16319E-04,-0.14271E-04,-0.13218E-04,-0.11690E-04,-0.10660E-04,
     . -0.10544E-04,-0.95949E-05,-0.87269E-05,-0.96875E-05,-0.10683E-04,
     . -0.10301E-04,-0.98032E-05,-0.10359E-04,-0.11817E-04,-0.12743E-04,
     . -0.13171E-04,-0.13900E-04,-0.10185E-04, 0.15162E-05, 0.33102E-05,
     .  0.29977E-05, 0.38426E-05, 0.16204E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.10926E-04,-0.18669E-04,-0.21204E-04,-0.19907E-04,-0.17998E-04,
     . -0.15498E-04,-0.13461E-04,-0.12361E-04,-0.10822E-04,-0.97917E-05,
     . -0.96644E-05,-0.86806E-05,-0.77894E-05,-0.86921E-05,-0.96412E-05,
     . -0.92361E-05,-0.87963E-05,-0.94560E-05,-0.11019E-04,-0.12060E-04,
     . -0.12593E-04,-0.13414E-04,-0.98727E-05, 0.15972E-05, 0.33681E-05,
     .  0.30671E-05, 0.40278E-05, 0.15741E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.96412E-05,-0.17662E-04,-0.20336E-04,-0.19074E-04,-0.17187E-04,
     . -0.14699E-04,-0.12650E-04,-0.11551E-04,-0.10035E-04,-0.90046E-05,
     . -0.88079E-05,-0.77778E-05,-0.68750E-05,-0.77662E-05,-0.86574E-05,
     . -0.82060E-05,-0.78241E-05,-0.85880E-05,-0.10266E-04,-0.11412E-04,
     . -0.12049E-04,-0.12951E-04,-0.95486E-05, 0.16551E-05, 0.34259E-05,
     .  0.31366E-05, 0.40625E-05, 0.15972E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.83218E-05,-0.16493E-04,-0.19178E-04,-0.17940E-04,-0.16111E-04,
     . -0.13646E-04,-0.11609E-04,-0.10521E-04,-0.90046E-05,-0.79630E-05,
     . -0.77199E-05,-0.66319E-05,-0.56944E-05,-0.65509E-05,-0.73958E-05,
     . -0.68981E-05,-0.65741E-05,-0.74884E-05,-0.93056E-05,-0.10579E-04,
     . -0.11354E-04,-0.12384E-04,-0.91782E-05, 0.17477E-05, 0.35069E-05,
     .  0.32292E-05, 0.41088E-05, 0.16319E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.83796E-05,-0.15903E-04,-0.18345E-04,-0.17153E-04,-0.15370E-04,
     . -0.12917E-04,-0.10833E-04,-0.97454E-05,-0.82755E-05,-0.72222E-05,
     . -0.69213E-05,-0.58218E-05,-0.48727E-05,-0.57176E-05,-0.64931E-05,
     . -0.59491E-05,-0.56713E-05,-0.67130E-05,-0.86227E-05,-0.99884E-05,
     . -0.10856E-04,-0.11979E-04,-0.88426E-05, 0.19792E-05, 0.33681E-05,
     .  0.32870E-05, 0.41435E-05, 0.16667E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.67940E-05,-0.14815E-04,-0.17512E-04,-0.16389E-04,-0.14630E-04,
     . -0.12176E-04,-0.10116E-04,-0.90394E-05,-0.75810E-05,-0.64931E-05,
     . -0.61574E-05,-0.50463E-05,-0.40972E-05,-0.49074E-05,-0.56134E-05,
     . -0.50347E-05,-0.48264E-05,-0.59838E-05,-0.79977E-05,-0.94560E-05,
     . -0.10394E-04,-0.11574E-04,-0.85648E-05, 0.20370E-05, 0.34375E-05,
     .  0.33449E-05, 0.41667E-05, 0.16898E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.58565E-05,-0.13819E-04,-0.16505E-04,-0.15417E-04,-0.13681E-04,
     . -0.11250E-04,-0.92014E-05,-0.81481E-05,-0.66898E-05,-0.55556E-05,
     . -0.51505E-05,-0.40162E-05,-0.30903E-05,-0.38889E-05,-0.45255E-05,
     . -0.39005E-05,-0.37616E-05,-0.50463E-05,-0.71759E-05,-0.87500E-05,
     . -0.98032E-05,-0.11111E-04,-0.82639E-05, 0.20833E-05, 0.35301E-05,
     .  0.36690E-05, 0.40278E-05, 0.18287E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.54630E-05,-0.13194E-04,-0.15787E-04,-0.14711E-04,-0.12998E-04,
     . -0.10579E-04,-0.85417E-05,-0.75116E-05,-0.60417E-05,-0.48843E-05,
     . -0.44676E-05,-0.33218E-05,-0.23958E-05,-0.31597E-05,-0.37269E-05,
     . -0.30903E-05,-0.30093E-05,-0.43866E-05,-0.65856E-05,-0.82407E-05,
     . -0.93866E-05,-0.10775E-04,-0.80556E-05, 0.21181E-05, 0.35995E-05,
     .  0.37037E-05, 0.40625E-05, 0.18519E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.51852E-05,-0.12627E-04,-0.15104E-04,-0.14051E-04,-0.12361E-04,
     . -0.99306E-05,-0.78935E-05,-0.68750E-05,-0.54282E-05,-0.42593E-05,
     . -0.38079E-05,-0.26505E-05,-0.17245E-05,-0.24653E-05,-0.29745E-05,
     . -0.23148E-05,-0.23032E-05,-0.37847E-05,-0.60532E-05,-0.77315E-05,
     . -0.89583E-05,-0.10451E-04,-0.78472E-05, 0.21528E-05, 0.36458E-05,
     .  0.37384E-05, 0.41088E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.46875E-05,-0.11863E-04,-0.14213E-04,-0.13183E-04,-0.11528E-04,
     . -0.91319E-05,-0.71181E-05,-0.60995E-05,-0.46528E-05,-0.34722E-05,
     . -0.29630E-05,-0.18056E-05,-0.89120E-06,-0.15741E-05,-0.20023E-05,
     . -0.13310E-05,-0.14005E-05,-0.29977E-05,-0.53588E-05,-0.71412E-05,
     . -0.84722E-05,-0.10058E-04,-0.75926E-05, 0.21991E-05, 0.37269E-05,
     .  0.37731E-05, 0.41551E-05, 0.18981E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.45255E-05,-0.11377E-04,-0.13588E-04,-0.12558E-04,-0.10937E-04,
     . -0.85532E-05,-0.65509E-05,-0.55324E-05,-0.40972E-05,-0.29051E-05,
     . -0.23727E-05,-0.12153E-05,-0.31250E-06,-0.94907E-06,-0.13194E-05,
     . -0.64815E-06,-0.79861E-06,-0.24653E-05,-0.48611E-05,-0.67014E-05,
     . -0.80903E-05,-0.97222E-05,-0.74306E-05, 0.20023E-05, 0.37847E-05,
     .  0.38079E-05, 0.41898E-05, 0.19097E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.44560E-05,-0.10949E-04,-0.12975E-04,-0.11944E-04,-0.10394E-04,
     . -0.80440E-05,-0.60532E-05,-0.50231E-05,-0.35532E-05,-0.23495E-05,
     . -0.18171E-05,-0.65972E-06, 0.24306E-06,-0.35880E-06,-0.68287E-06,
     . -0.11574E-07,-0.20833E-06,-0.19444E-05,-0.44097E-05,-0.63194E-05,
     . -0.77778E-05,-0.94792E-05,-0.72801E-05, 0.20370E-05, 0.38426E-05,
     .  0.38426E-05, 0.42130E-05, 0.19213E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.44329E-05,-0.10463E-04,-0.12303E-04,-0.11250E-04,-0.96528E-05,
     . -0.73148E-05,-0.53704E-05,-0.43750E-05,-0.29051E-05,-0.16667E-05,
     . -0.11111E-05, 0.11574E-07, 0.91435E-06, 0.37037E-06, 0.12731E-06,
     .  0.79861E-06, 0.50926E-06,-0.13079E-05,-0.38426E-05,-0.58333E-05,
     . -0.73727E-05,-0.91551E-05,-0.70718E-05, 0.20949E-05, 0.39120E-05,
     .  0.38773E-05, 0.42477E-05, 0.19329E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.45255E-05,-0.10104E-04,-0.11759E-04,-0.10752E-04,-0.91898E-05,
     . -0.68403E-05,-0.48958E-05,-0.39005E-05,-0.24537E-05,-0.12037E-05,
     . -0.64815E-06, 0.49769E-06, 0.14005E-05, 0.89120E-06, 0.67130E-06,
     .  0.13542E-05, 0.10185E-05,-0.86806E-06,-0.34491E-05,-0.54977E-05,
     . -0.70949E-05,-0.89352E-05,-0.69329E-05, 0.21181E-05, 0.39583E-05,
     .  0.39005E-05, 0.42824E-05, 0.19444E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.41551E-05,-0.96759E-05,-0.11296E-04,-0.10278E-04,-0.87384E-05,
     . -0.64120E-05,-0.44676E-05,-0.34722E-05,-0.20255E-05,-0.77546E-06,
     . -0.20833E-06, 0.93750E-06, 0.18519E-05, 0.13773E-05, 0.11921E-05,
     .  0.18634E-05, 0.14931E-05,-0.45139E-06,-0.30787E-05,-0.51852E-05,
     . -0.68403E-05,-0.87384E-05,-0.67940E-05, 0.21644E-05, 0.39931E-05,
     .  0.39236E-05, 0.43056E-05, 0.19560E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.37963E-05,-0.91667E-05,-0.10741E-04,-0.97454E-05,-0.82060E-05,
     . -0.58796E-05,-0.39468E-05,-0.29630E-05,-0.15162E-05,-0.25463E-06,
     .  0.33565E-06, 0.14815E-05, 0.24074E-05, 0.19676E-05, 0.18287E-05,
     .  0.25000E-05, 0.20718E-05, 0.57870E-07,-0.26389E-05,-0.48032E-05,
     . -0.65278E-05,-0.84838E-05,-0.66319E-05, 0.21991E-05, 0.44444E-05,
     .  0.36227E-05, 0.43403E-05, 0.19676E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.37500E-05,-0.88773E-05,-0.10336E-04,-0.93403E-05,-0.78241E-05,
     . -0.55093E-05,-0.35880E-05,-0.26042E-05,-0.11690E-05, 0.92593E-07,
     .  0.69444E-06, 0.18403E-05, 0.27662E-05, 0.23611E-05, 0.22569E-05,
     .  0.29167E-05, 0.24537E-05, 0.39352E-06,-0.23495E-05,-0.45602E-05,
     . -0.63194E-05,-0.83218E-05,-0.65278E-05, 0.22222E-05, 0.44676E-05,
     .  0.36458E-05, 0.43634E-05, 0.19792E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.35880E-05,-0.85648E-05,-0.99537E-05,-0.89699E-05,-0.74884E-05,
     . -0.51968E-05,-0.32755E-05,-0.22801E-05,-0.84491E-06, 0.41667E-06,
     .  0.10301E-05, 0.21759E-05, 0.31134E-05, 0.27199E-05, 0.26505E-05,
     .  0.32986E-05, 0.28009E-05, 0.70602E-06,-0.20718E-05,-0.43287E-05,
     . -0.61343E-05,-0.81713E-05,-0.64352E-05, 0.22454E-05, 0.44907E-05,
     .  0.36690E-05, 0.46528E-05, 0.18287E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.28241E-05,-0.80324E-05,-0.94676E-05,-0.84491E-05,-0.70023E-05,
     . -0.48032E-05,-0.29167E-05,-0.18866E-05,-0.42824E-06, 0.83333E-06,
     .  0.14120E-05, 0.25463E-05, 0.35069E-05, 0.31597E-05, 0.31134E-05,
     .  0.37500E-05, 0.32060E-05, 0.10764E-05,-0.17593E-05,-0.40509E-05,
     . -0.59028E-05,-0.79977E-05,-0.63194E-05, 0.22685E-05, 0.45139E-05,
     .  0.37037E-05, 0.46644E-05, 0.18403E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.32870E-05,-0.81134E-05,-0.92940E-05,-0.81134E-05,-0.65741E-05,
     . -0.44097E-05,-0.26042E-05,-0.16435E-05,-0.19676E-06, 0.10648E-05,
     .  0.16551E-05, 0.28009E-05, 0.37616E-05, 0.34491E-05, 0.34144E-05,
     .  0.40509E-05, 0.34722E-05, 0.12963E-05,-0.15509E-05,-0.38657E-05,
     . -0.57523E-05,-0.78704E-05,-0.62500E-05, 0.22917E-05, 0.45370E-05,
     .  0.37153E-05, 0.46759E-05, 0.18519E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.32523E-05,-0.79398E-05,-0.90625E-05,-0.78704E-05,-0.63310E-05,
     . -0.41551E-05,-0.23380E-05,-0.13773E-05, 0.57870E-07, 0.12963E-05,
     .  0.18866E-05, 0.30208E-05, 0.39931E-05, 0.37153E-05, 0.36921E-05,
     .  0.42940E-05, 0.36921E-05, 0.15046E-05,-0.13657E-05,-0.37153E-05,
     . -0.56250E-05,-0.77662E-05,-0.61806E-05, 0.23032E-05, 0.45486E-05,
     .  0.37384E-05, 0.46875E-05, 0.18634E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.31134E-05,-0.77199E-05,-0.87963E-05,-0.75810E-05,-0.60417E-05,
     . -0.38889E-05,-0.20949E-05,-0.11111E-05, 0.33565E-06, 0.15741E-05,
     .  0.21759E-05, 0.33102E-05, 0.42824E-05, 0.40046E-05, 0.39931E-05,
     .  0.45833E-05, 0.39583E-05, 0.17361E-05,-0.11806E-05,-0.35532E-05,
     . -0.54745E-05,-0.76505E-05,-0.61111E-05, 0.23148E-05, 0.45486E-05,
     .  0.37500E-05, 0.46875E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.29514E-05,-0.75579E-05,-0.86458E-05,-0.74421E-05,-0.59144E-05,
     . -0.37616E-05,-0.19560E-05,-0.94907E-06, 0.48611E-06, 0.17245E-05,
     .  0.23611E-05, 0.35185E-05, 0.44907E-05, 0.42014E-05, 0.41667E-05,
     .  0.47338E-05, 0.40972E-05, 0.18981E-05,-0.98380E-06,-0.33449E-05,
     . -0.52894E-05,-0.75116E-05,-0.60532E-05, 0.22338E-05, 0.45602E-05,
     .  0.37731E-05, 0.46991E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.30671E-05,-0.75231E-05,-0.85532E-05,-0.73380E-05,-0.57870E-05,
     . -0.36343E-05,-0.18403E-05,-0.83333E-06, 0.60185E-06, 0.18403E-05,
     .  0.24884E-05, 0.36574E-05, 0.46065E-05, 0.43287E-05, 0.43287E-05,
     .  0.49074E-05, 0.42824E-05, 0.20949E-05,-0.75231E-06,-0.30671E-05,
     . -0.49653E-05,-0.72569E-05,-0.60069E-05, 0.20833E-05, 0.45602E-05,
     .  0.37731E-05, 0.46991E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.31944E-05,-0.74884E-05,-0.84606E-05,-0.72454E-05,-0.56944E-05,
     . -0.35532E-05,-0.17593E-05,-0.74074E-06, 0.67130E-06, 0.19213E-05,
     .  0.26273E-05, 0.38079E-05, 0.47569E-05, 0.45023E-05, 0.45139E-05,
     .  0.51042E-05, 0.45023E-05, 0.23958E-05,-0.37037E-06,-0.26389E-05,
     . -0.45602E-05,-0.68981E-05,-0.57176E-05, 0.22454E-05, 0.43519E-05,
     .  0.37731E-05, 0.46991E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.31366E-05,-0.74769E-05,-0.84491E-05,-0.72338E-05,-0.56597E-05,
     . -0.35069E-05,-0.17245E-05,-0.70602E-06, 0.71759E-06, 0.19560E-05,
     .  0.26505E-05, 0.38426E-05, 0.47685E-05, 0.44907E-05, 0.45023E-05,
     .  0.50810E-05, 0.44792E-05, 0.23843E-05,-0.32407E-06,-0.24190E-05,
     . -0.40162E-05,-0.60648E-05,-0.50347E-05, 0.22569E-05, 0.44097E-05,
     .  0.36227E-05, 0.46875E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.30903E-05,-0.74884E-05,-0.84954E-05,-0.72685E-05,-0.56713E-05,
     . -0.35185E-05,-0.17477E-05,-0.71759E-06, 0.70602E-06, 0.19444E-05,
     .  0.26505E-05, 0.38079E-05, 0.47222E-05, 0.44560E-05, 0.44907E-05,
     .  0.50694E-05, 0.44676E-05, 0.23843E-05,-0.27778E-06,-0.22454E-05,
     . -0.36921E-05,-0.55556E-05,-0.41667E-05, 0.36806E-05, 0.46875E-05,
     .  0.38773E-05, 0.45602E-05, 0.18750E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.31713E-05,-0.75926E-05,-0.86227E-05,-0.74074E-05,-0.57870E-05,
     . -0.36227E-05,-0.18287E-05,-0.78704E-06, 0.62500E-06, 0.18634E-05,
     .  0.25810E-05, 0.37616E-05, 0.46528E-05, 0.43866E-05, 0.44444E-05,
     .  0.50694E-05, 0.45370E-05, 0.25579E-05, 0.11574E-07,-0.18981E-05,
     . -0.32176E-05,-0.48032E-05,-0.30556E-05, 0.51505E-05, 0.46528E-05,
     .  0.35185E-05, 0.45023E-05, 0.18171E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.33449E-05,-0.77083E-05,-0.87153E-05,-0.75000E-05,-0.58796E-05,
     . -0.37037E-05,-0.18981E-05,-0.84491E-06, 0.56713E-06, 0.18056E-05,
     .  0.25463E-05, 0.37153E-05, 0.45949E-05, 0.43287E-05, 0.43634E-05,
     .  0.49769E-05, 0.44792E-05, 0.25926E-05, 0.16204E-06,-0.16088E-05,
     . -0.27315E-05,-0.41551E-05,-0.24421E-05, 0.54977E-05, 0.46296E-05,
     .  0.35648E-05, 0.43403E-05, 0.17940E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.34954E-05,-0.78472E-05,-0.88542E-05,-0.76273E-05,-0.59838E-05,
     . -0.38079E-05,-0.20370E-05,-0.98380E-06, 0.43981E-06, 0.16782E-05,
     .  0.24074E-05, 0.35880E-05, 0.44676E-05, 0.41898E-05, 0.42361E-05,
     .  0.48727E-05, 0.44097E-05, 0.25926E-05, 0.25463E-06,-0.13773E-05,
     . -0.23264E-05,-0.34722E-05,-0.14931E-05, 0.66204E-05, 0.48495E-05,
     .  0.30671E-05, 0.42130E-05, 0.17824E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.36343E-05,-0.80556E-05,-0.90972E-05,-0.78819E-05,-0.62384E-05,
     . -0.40394E-05,-0.22685E-05,-0.12153E-05, 0.21991E-06, 0.14699E-05,
     .  0.21875E-05, 0.33449E-05, 0.42130E-05, 0.39352E-05, 0.40046E-05,
     .  0.46644E-05, 0.42824E-05, 0.25694E-05, 0.41667E-06,-0.93750E-06,
     . -0.15394E-05,-0.23727E-05,-0.24306E-06, 0.78009E-05, 0.44329E-05,
     .  0.27431E-05, 0.41551E-05, 0.17477E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.39468E-05,-0.83218E-05,-0.93403E-05,-0.81250E-05,-0.64583E-05,
     . -0.42477E-05,-0.24421E-05,-0.13889E-05, 0.34722E-07, 0.12847E-05,
     .  0.20255E-05, 0.32060E-05, 0.40625E-05, 0.37616E-05, 0.38310E-05,
     .  0.45139E-05, 0.41667E-05, 0.25579E-05, 0.55556E-06,-0.53241E-06,
     . -0.85648E-06,-0.16088E-05, 0.43981E-06, 0.84028E-05, 0.49653E-05,
     .  0.24884E-05, 0.40162E-05, 0.17477E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00,
     . -0.40509E-05,-0.85301E-05,-0.95949E-05,-0.83796E-05,-0.66782E-05,
     . -0.44560E-05,-0.26505E-05,-0.15741E-05,-0.12731E-06, 0.11343E-05,
     .  0.18866E-05, 0.30787E-05, 0.39120E-05, 0.35880E-05, 0.36574E-05,
     .  0.43750E-05, 0.40972E-05, 0.25579E-05, 0.71759E-06,-0.10417E-06,
     . -0.13889E-06,-0.72917E-06, 0.13773E-05, 0.93866E-05, 0.36921E-05,
     .  0.23264E-05, 0.39699E-05, 0.17130E-05, 0.00000E+00, 0.00000E+00,
     .  0.00000E+00, 0.00000E+00, 0.00000E+00
     .  /) )

        ! Input
        real(kind=time_prec), intent(in) :: time ! Model time [s]

        ! Output Variables
        real, intent(out), dimension(gr%nnzp) ::
     .  wmt,          ! w wind on thermodynamic grid                 [m/s]
     .  wmm,          ! w wind on momentum grid                      [m/s]
     .  radht,        ! Radiative heating rate                       [K/s]
     .  thlm_forcing, ! Liquid water potential temperature tendency  [K/s]
     .  rtm_forcing   ! Total water mixing ratio tendency            [kg/kg/s]

        ! Output Variables (optional)
        real, optional, intent(out), dimension(gr%nnzp,sclr_dim) ::
     .  sclrm_forcing ! Passive scalar forcing [units vary]

        ! Local Variables
        real, dimension(nzrad) :: radhtz
        real :: a
        integer :: k, i1, i2

        ! Large scale subsidence
        wmt(1:gr%nnzp) = 0.0
        wmm(1:gr%nnzp) = 0.0

        if ( .not. lbugsrad ) then

          ! Calculate radiative heating rate
          if ( time <=  600. ) then
            radhtz = krad(:,1)

          else if ( time >= ntimes * 600. ) then
            radhtz = krad(:,ntimes)

          else
            i1 = 1
            do while ( i1 <= ntimes-1 )
              i2 = i1 + 1
              if ( time >= 600. * i1 .and. time < 600. * i2  ) then
                a      = ( time - 600. * i1 )/( 600. * i2 - 600. * i1)
                radhtz(:) = ( 1. - a ) * krad(:,i1) + a * krad(:,i2)
                i1     = ntimes
              end if
              i1 = i2
            end do
          end if ! time <= times(1)

          radht = zlinterp_fnc( gr%nnzp, nzrad, gr%zt, zrad, radhtz )

          ! Radiative theta-l tendency

          thlm_forcing = radht

        else ! Compute heating rate interactively with BUGSrad

          thlm_forcing = 0.0

        end if ! ~lbugsrad

        ! Boundary conditions
        thlm_forcing(1) = 0.0  ! Below surface

        ! Large scale advective moisture tendency
        rtm_forcing(:) = 0.0


        if ( present( sclrm_forcing ) ) then 
          sclrm_forcing(1:gr%nnzp,SCLR_THETA) = thlm_forcing(1:gr%nnzp)
          sclrm_forcing(1:gr%nnzp,SCLR_RT)    = rtm_forcing(1:gr%nnzp)
        end if

        return
        end subroutine lba_tndcy

!----------------------------------------------------------------------
        subroutine lba_sfclyr( time, z, rho0,
     .                         thlm_sfc, um_sfc, vm_sfc, 
     .                         upwp_sfc, vpwp_sfc,
     .                         wpthlp_sfc, wprtp_sfc, ustar,
     .                         wpsclrp_sfc, wpedsclrp_sfc )

!       Description:
!       This subroutine computes surface fluxes of horizontal momentum,
!       heat and moisture according to GCSS BOMEX specifications

!       References:
!       Grabowski, et al. (2005)
!----------------------------------------------------------------------

        use constants, only: sclr_dim, pi, grav, Lv, Cp
        use stats_prec, only: time_prec

        implicit none

        ! External
        real, external :: diag_ustar

        intrinsic :: max, sqrt, present

        ! Constant Parameters
        real, parameter :: 
     .  ubmin = 0.25,  ! Minimum value for ubar 
     .  z0    = 0.035  ! ARM mom. roughness height

        ! Input Variables
        real(kind=time_prec), intent(in) :: 
     .  time      ! Current time        [s] 

        real, intent(in) :: 
     .  z,        ! Height at zt=2      [m] 
     .  rho0,     ! Density at zm=1     [kg/m^3] 
     .  um_sfc,   ! um at (2)           [m/s]
     .  vm_sfc,   ! vm at (2)           [m/s]
     .  thlm_sfc  ! thlm at (2)         [m/s]

        ! Output variables
        real, intent(out) :: 
     .  upwp_sfc,    ! u'w' at (1)      [m^2/s^2]
     .  vpwp_sfc,    ! v'w'at (1)       [m^2/s^2]
     .  wpthlp_sfc,  ! w'th_l' at (1)   [(m K)/s]  
     .  wprtp_sfc,   ! w'r_t'(1) at (1) [(m kg)/(s kg)]
     .  ustar        ! surface friction velocity [m/s]

        ! Output variables (optional)
        real, intent(out), optional, dimension(sclr_dim) :: 
     .  wpsclrp_sfc,  ! Passive scalar surface flux      [units m/s] 
     .  wpedsclrp_sfc ! Passive eddy-scalar surface flux [units m/s]

        ! Local variables
!        real :: ft, ubar, ustar, bflx
        real :: ft, ubar, bflx

        ! Compute heat and moisture fluxes
        ! From Table A.1.
        ft = max( 0., 
     .               cos( 0.5 * pi * ( (5.25 - ( time/3600.)) / 5.25 ) )
     .          )

        wpthlp_sfc =  ( 270. * ft**1.5 ) / ( rho0 * Cp )
        wprtp_sfc  =  ( 554. * ft**1.3 ) / ( rho0 * Lv )


        ! Let passive scalars be equal to rt and theta_l for now 
        if ( present( wpsclrp_sfc ) ) then 
          wpsclrp_sfc(SCLR_THETA) = wpthlp_sfc
          wpsclrp_sfc(SCLR_RT)    = wprtp_sfc
        end if

        if ( present( wpsclrp_sfc ) ) then 
          wpedsclrp_sfc(SCLR_THETA) = wpthlp_sfc
          wpedsclrp_sfc(SCLR_RT)    = wprtp_sfc
        end if

        ! Compute momentum fluxes using ARM formulae

        ubar = max( ubmin, sqrt( um_sfc**2 + vm_sfc**2 ) )

        bflx = grav/thlm_sfc * wpthlp_sfc

        ! Compute ustar
        ustar = diag_ustar( z, bflx, ubar, z0 )

        upwp_sfc = -um_sfc * ustar**2 / ubar
        vpwp_sfc = -vm_sfc * ustar**2 / ubar

        return
        end subroutine lba_sfclyr

        end module lba

