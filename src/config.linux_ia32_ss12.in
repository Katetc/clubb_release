# $Id: config.linux_ia32_ss12.in,v 1.1 2008-04-16 18:38:35 dschanen Exp $
# Makefile definitions for Sun Studio's Fortran compiler on GNU/Linux

# == Paths ==
# This is where the make command is going to put the resulting files
PREFIX = ..
BINDIR = $(PREFIX)/bin
LIBDIR = $(PREFIX)/lib

# == Compiler invocation ==
FC = f95 # Sun Fortran 8.3

# == Debugging ==
# It is sometimes helpful to turn on floating-point trapping for the 
#  standalone program, but this will not work when using the tuner.
# In Sun f95: remove the reference to ftrap, or use -ftrap=common
DEBUG = -g -C -fns=no -ftrap=%none #-stackvar -xcheck=init_local -ftrap=common

# == Machine specific flags ==
# Note that when linking to sunperf (for LAPACK) you must use -dalign
ARCH = -m64 -xarch=sse3 -xcache=native -xchip=native -dalign
#ARCH = -m64 -xarch=sse3a -xcache=native -xchip=opteron -dalign

# == Optimization ==
# Sun's f95 has great difficulty with statistics.F
# Either turn off optimization for that file or expect a long compilation. 
# Using -xtypemap it is possible to compile for quad precision floating 
# point on SPARC, but on AMD64/EMT64 this is still not implemented.
# These are all pretty conservative options, check the your compiler manual 
# for information on using more aggressive techniques (inlining, etc.)
# -KPIC is needed for shared libs
# Note that -g is needed for profiling.
# These options are good on a SPARC and AMD64 machine
#OPTIMIZE = -g -xO3 -xvector=lib -ftrap=%none
# This works on x86/x64 only
OPTIMIZE = -g -xO3 -xvector=simd -ftrap=%none
# These options are good for parallel tuning on ketley or OpenMP WRF-HOC.
#OPTIMIZE = -g -xopenmp -xparallel -stackvar -xipo=2 -xvector=simd -xO4 -ftrap=%none

# == Compiler flags (all) ==
# Preprocessing:
#   -DSTATS enables statistics
#   -DSCALARS enables passive scalars
#   -DBIG_ENDIAN_IO use only if compiler performs big endian file i/O
#                   regardless of internal representation
#   -DLITTLE_ENDIAN_IO use only if compiler performs little endian file i/O
#                   regardless of internal representation
# Note that natively SPARC is big endian and AMD64/IA32 are little endian.
#   -Dradoffline and -Dnooverlap (see bugsrad documentation)
# You will need to `make clean' if you change these
FCFLAGS = $(DEBUG) $(ARCH) -DSTATS -Dnooverlap -Dradoffline -M$(NC_LOC)/include
#FCFLAGS = $(OPTIMIZE) $(ARCH) -DSTATS -Dnooverlap -Dradoffline -M$(NC_LOC)/include
#FCFLAGS = $(OPTIMIZE) $(ARCH) -M$(NC_LOC)/include


# == NetCDF Location  ==
#NC_LOC = /usr/local/netcdf-sun32
NC_LOC = /usr/local/netcdf-sun64

# == LAPACK libraries ==
LAPACK = -xlic_lib=sunperf

# == Linking Flags ==
# Use -s to strip (no debugging); 
# -Bstatic; for static linking of libraries
# -xlibmopt; link the optimized version of libm (this seems not to work on GNU/Linux)
LDFLAGS = -L$(LIBDIR) -R$(LIBDIR) -lhoc_param -lhoc_bugsrad -L$(NC_LOC)/lib -lnetcdf $(LAPACK)

# == Static library processing ==
AR = ar
ARFLAGS = cru
RANLIB = ranlib

# == Shared library processing ==
SHARED = $(FC)
SHAREDFLAGS = -G
