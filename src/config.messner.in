# $Id: config.messner.in,v 1.9 2006-05-04 16:35:34 dschanen Exp $
# Configuration file for Messner node

# == Paths ==
# This is where the make command is going to put the resulting files
PREFIX = $(HOME)/hoc_v2.2_tuner
BINDIR = $(PREFIX)/bin
LIBDIR = $(PREFIX)/lib

# == Compiler invocation ==
FC = g95 #	G95
#FC = ifort #	Intel Fortran 9
#FC = pgf90 #	Portland Group Fortran 90 5.x/6.x

# == Debugging ==
# It is sometimes helpful to turn on floating-point trapping for the 
#  standalone program, but this will not work when using the tuner.
# In PGF: -Ktrap=inv,unf
# In g95: `setenv G95_FPU_INVALID TRUE' or `export G95_FPU_INVALID=TRUE'
# In ifort: -fpe=0
# The usual options:
DEBUG = -g -C -mieee-fp -ftrace=full #	g95
#DEBUG = -g -check bounds -mieee-fp #	ifort
#DEBUG = -g -C -Kieee #			pgf90

# == Machine specific flags ==
ARCH = -march=pentium4 -msse2 -mfpmath=sse # g95, P4
#ARCH = -arch pn4 -msse2 # ifort, P4
#ARCH = -tp p7 # pgf90, P4

# == Optimization ==
# These are all pretty conservative options. Check your compiler manual
# for information on using more aggressive techniques (inlining, etc.)
# Note: using -r8 on pgf90 breaks the NaN checking, so use it with caution
OPTIMIZE = -O2

# == NetCDF Location ==
NC_LOC = /usr/local/netcdf-g95
#NC_LOC = /usr/local/netcdf-intel
#NC_LOC = /usr/local/netcdf-pgi

# == Linking Flags ==
# Use -s to strip (no debugging); 
# Use -L<library path> -l<lib> to link in an external library
# Use -Wl,-rpath <library path> to set a search path for shared libs
LDFLAGS = -L$(LIBDIR) -Wl,-rpath,$(LIBDIR) -lhoc_param -lhoc_bugsrad -L$(NC_LOC)/lib -lnetcdf
#LDFLAGS = -L$(LIBDIR) -lhoc_param -lhoc_bugsrad -L$(NC_LOC)/lib
#-Wl,-rpath,$(LIBDIR) 

# == Compiler flags (all) ==
# Preprocessing Directives:
#   -DSTATS enables statistics
#   -DSCALARS enables passive scalars
#   -DBIG_ENDIAN_IO use only if compiler performs big endian file i/O
#                   regardless of internal representation
#   -DLITTLE_ENDIAN_IO use only if compiler performs little endian file i/O
#                   regardless of internal representation
#   -Dradoffline and -Dnooverlap (see bugsrad documentation)
# You will need to `make clean' if you change these
# Use -I<include path> to set a module or header file directory

FCFLAGS = $(ARCH) $(DEBUG) -DSTATS -Dnooverlap -Dradoffline -I$(NC_LOC)/include
#FCFLAGS = $(ARCH) $(OPTIMIZE) -DSTATS -Dnooverlap -Dradoffline -I$(NC_LOC)/include
#FCFLAGS = $(ARCH) $(OPTIMIZE) -DSTATS -DSCALARS -Dnooverlap -Dradoffline -I$(NC_LOC)/include 

# == Static library processing ==
AR = ar
ARFLAGS = cru
RANLIB = ranlib

# == Shared library processing ==
SHARED = $(FC)
SHAREDFLAGS = -fPIC -shared
